<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <script type="text/javascript">

            // if the launcher page is in an error state
            var mError = false;

            /// if the launcher page can have it's status refreshed
            var mRefresh = true;

            /// timestamp when the launcher was last refreshed, 0 if never
            var mRefreshed = 0;

            /// if server status has been set
            var mServerStatus = false;

            /// if the servers are healthy and responding
            var mServerHealth = false;

            /// if the servers are closed at our whim rather than a down service
            var mServerMaintenance = false;

            /// countdown to when the servers will be back open
            /// set to a unix timestamp if the countdown on
            /// set to 0 if the countdown is off
            var mCountdown = 0;

            /// timer id
            var mCountdownId = -1;

            // if the patcher is done with itss business
            var mPatcherStatus = false;


            var mousebuttondown = false;
            var serverstatusdataload = false;
            var patchnoteunlocked = true;
            var localizedkeymap = {
                "FAILED_TO_CONNECT" : "CONNECTION FAILED",
                "PLAY" : "PLAY",
                "SERVER_STATUS" : "SERVER STATUS",
                "SUPPORT_STRING" : "SUPPORT STRING", // ?
                "LOST_CONNECTION" : "DISCONNECTED",
                "SERVER_GOOD" : "CONNECTED",
                "SERVER_UNAVAILABLE" : "UNAVAILABLE",
                "CONTACTING" : "CONTACTING...",
                "REFRESH" : "REFRESH",
                "VALIDATE_INSTALL" : "VALIDATE&nbsp;&nbsp;INSTALL"

            };
            var localizedstringmap = {};


            //@Param currentprogresspercent is the current patching percent [0-1]
            function updateProgressBar(currentprogresspercent)
            {
                var endcontainer = document.getElementById("Progress_bar_patching_end" );
                var middlecontainer = document.getElementById("Progress_bar_patching_middle" );
                var headcontainer = document.getElementById("Progress_bar_patching_head");
                if(headcontainer == null)
                {
                    for (var i=96; i<=100; i++)
                    {
                        headcontainer = document.getElementById("Progress_bar_patching_head"+(i-1));
                        if (headcontainer != null)
                        {
                            break;
                        }
                    }
                }
                var backcontainer = document.getElementById("Progress_bar");
                if(backcontainer == null){
                    backcontainer = document.getElementById("Progress_bar_full");
                }
                if (currentprogresspercent<= 0)
                {
                    endcontainer.style.visibility = "hidden";
                    middlecontainer.style.visibility = "hidden";
                    headcontainer.style.visibility = "hidden";
                    backcontainer.id = "Progress_bar";
                }
                else if (currentprogresspercent == 1)
                {
                    endcontainer.style.visibility = "hidden";
                    middlecontainer.style.visibility = "hidden";
                    headcontainer.style.visibility = "hidden";
                    backcontainer.id = "Progress_bar_full";
                    backcontainer.style.visibility = "visible";
                }
                else
                {
                    backcontainer.id = "Progress_bar_full";
                    backcontainer.style.visibility = "hidden";
                    backcontainer.id = "Progress_bar";
                    backcontainer.style.visibility = "visible";
                    endcontainer.style.visibility = "visible";
                    middlecontainer.style.visibility = "visible";
                    headcontainer.id = "Progress_bar_patching_head";
                    headcontainer.style.visibility = "visible";
                    middlecontainer.style.width = (currentprogresspercent*524);
                }
            }

            function setPlayButtonActive()
            {

                // stop countdown
                stopCountdown();

                // turn on play button
                var container = document.getElementById("Playbutton_active");
                if (container != null)
                {
                    container.style.display = "block";
                    container.style.visibility= "visible";
                    container.setAttribute("onmouseover","showMouseOverPlayButton()");
                    container.setAttribute("onmouseout", "showMouseOutPlayButton()");
                    container.setAttribute("onmousedown", "showMouseDownPlayButton()");
                    container.setAttribute("onclick","clickPlayButton()");
                }

                // turn off deactive
                container = document.getElementById("Playbutton_deactive");
                if (container != null)
                {

                    container.style.display = "none";
                    container.style.visibility= "hidden";


                }

            }

            function setPlayButtonDeactive()
            {
                var container = document.getElementById("Playbutton_active");
                if (container != null)
                {
                    container.style.display = "none";
                    container.style.visibility= "hidden";

                }


                container = document.getElementById("Playbutton_deactive");
                if (container != null)
                {

                    container.style.display = "block";
                    container.style.visibility= "visible";

                }

            }

            function showMouseOverPlayButton()
            {

                var container = document.getElementById("Playbutton_active");
                if (container != null)
                {
                    container.style.backgroundImage='url(images/PatcherPlayButtonOn.png)';
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }

            function showMouseOutPlayButton()
            {
                var container = document.getElementById("Playbutton_active");
                if (container != null)
                {
                    container.style.backgroundImage='url(images/PatcherPlayButtonActive.png)';
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }

            function showMouseDownPlayButton()
            {
                var container = document.getElementById("Playbutton_active");
                if (container != null)
                {
                    container.style.backgroundImage = 'url(images/PatcherPlayButtonOnClick.png)';
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }


            function setValidateButtonActive()
            {
                // turn on validate button
                var container = document.getElementById("Validatebutton_active");
                if (container != null)
                {
                    container.style.display = "block";
                    container.style.visibility = "visible";
                    container.setAttribute("onmouseover", "showMouseOverValidateButton()");
                    container.setAttribute("onmouseout", "showMouseOutValidateButton()");
                    container.setAttribute("onmousedown", "showMouseDownValidateButton()");
                    container.setAttribute("onclick", "clickValidateButton()");
                }

                // turn off deactive
                container = document.getElementById("Validatebutton_deactive");
                if (container != null)
                {

                    container.style.display = "none";
                    container.style.visibility = "hidden";


                }

            }


            function setValidateButtonDeactive()
            {
                var container = document.getElementById("Validatebutton_active");
                if (container != null)
                {
                    container.style.display = "none";
                    container.style.visibility = "hidden";

                }


                container = document.getElementById("Validatebutton_deactive");
                if (container != null)
                {

                    container.style.display = "block";
                    container.style.visibility = "visible";

                }

            }


            function setLeftCommentActive()
            {
                var container = document.getElementById("Progress_comment_bottom_left_container");

                if (container != null)
                {
                    container.setAttribute("onmouseover", "updateToolTipTextLeft(); showLeftCommentTooltip()");
                    container.setAttribute("onmouseout", "hideLeftCommentTooltip()");
                }
            }

            function updateToolTipTextLeft(text)
            {
                var tooltip = document.getElementById("Progress_comment_bottom_left_tooltip");
                var container = document.getElementById("Progress_comment_bottom_left_container");
                var orginalText = container.firstChild.firstChild.innerHTML;
                if (orginalText != "")
                {
                    tooltip.innerHTML = orginalText;
                }
            }

            function showLeftCommentTooltip()
            {
                var tooltip = document.getElementById("Progress_comment_bottom_left_tooltip");
                tooltip.style.display = "inline";
                tooltip.style.zIndex = "20";
            }

            function hideLeftCommentTooltip()
            {
                var tooltip = document.getElementById("Progress_comment_bottom_left_tooltip");
                tooltip.innerHTML = "";
                tooltip.style.display = "none";
                tooltip.style.zIndex = "0";
            }

            function setRightCommentActive()
            {
                var container = document.getElementById("Progress_comment_bottom_right_container");
                if (container != null)
                {
                    container.setAttribute("onmouseover", "updateToolTipTextRight(); showRightCommentTooltip()");
                    container.setAttribute("onmouseout", "hideRightCommentTooltip()");
                }
            }


            function updateToolTipTextRight()
            {
                var tooltip = document.getElementById("Progress_comment_bottom_right_tooltip");
                var container = document.getElementById("Progress_comment_bottom_right_container");
                var orginalText = container.firstChild.firstChild.innerHTML;
                if (orginalText != "")
                {
                    tooltip.innerHTML = orginalText;
                    var borderBuffer = 1;
                    var rightCommentLeftEdge = container.firstChild.offsetLeft + container.offsetLeft - borderBuffer;
                    tooltip.style.left += rightCommentLeftEdge;

                }




            }
            function showRightCommentTooltip()
            {
                var tooltip = document.getElementById("Progress_comment_bottom_right_tooltip");
                tooltip.style.display = "inline";
                tooltip.style.zIndex = "20";
            }

            function hideRightCommentTooltip()
            {
                var tooltip = document.getElementById("Progress_comment_bottom_right_tooltip");
                tooltip.innerHTML = "";
                tooltip.style.display = "none";
                tooltip.style.zIndex = "0";
            }



            function showMouseOverValidateButton()
            {

                var container = document.getElementById("Validatebutton_active");
                if (container != null)
                {
                    container.style.backgroundImage = 'url(images/PatcherValidateButtonOn.png)';
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }

            function showMouseOutValidateButton()
            {
                var container = document.getElementById("Validatebutton_active");
                if (container != null)
                {
                    container.style.backgroundImage = 'url(images/PatcherValidateButtonActive.png)';
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }

            function showMouseDownValidateButton()
            {
                var container = document.getElementById("Validatebutton_active");
                if (container != null)
                {
                    container.style.backgroundImage = 'url(images/PatcherValidateButtonOnClick.png)';
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }


            function showMouseOverMinButton()
            {
                var container = document.getElementById("Minbutton");
                if (container != null)
                {
                    container.style.visibility = "hidden";
                    if (!mousebuttondown)
                    {
                        container.className = "minButton on";
                    }
                    else
                    {
                        container.className = "minButton clicked";
                    }
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }

            function showMouseOutMinButton()
            {
                var container = document.getElementById("Minbutton");
                if (container != null)
                {
                    container.style.visibility = "hidden";
                    container.className = "minButton off";
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }

            function showMouseOverCloseButton()
            {
                var container = document.getElementById("Closebutton");
                if (container != null)
                {
                    container.style.visibility = "hidden";
                    if (!mousebuttondown)
                    {
                        container.className = "closeButton on";
                    }
                    else
                    {
                        container.className = "closeButton clicked";
                    }
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }

            function showMouseOutCloseButton()
            {
                var container = document.getElementById("Closebutton");
                if (container != null)
                {
                    container.style.visibility = "hidden";
                    container.className = "closeButton off";
                    container.style.visibility = "visible";
                }
                else
                {
                  return;
                }
            }

            function clickCloseButton()
            {
                mousebuttondown = false;
                var container = document.getElementById("Closebutton");
                if (container != null)
                {
                    container.style.visibility = "hidden";
                    container.className = "closeButton off";
                    container.style.visibility = "visible";
                    Client.closeCurrentApp();
                }
                else
                {
                    return;
                }
            }

            function clickMinButton()
            {
                mousebuttondown = false;
                var container = document.getElementById("Minbutton");
                if (container != null)
                {
                    container.style.visibility = "hidden";
                    container.className = "minButton off";
                    container.style.visibility = "visible";
                    Client.minCurrentApp();
                }
                else
                {
                    return;
                }
            }

            function clickPlayButton()
            {
                var container = document.getElementById("Playbutton_active");
                var playtext = document.getElementById("Play_button_font_active");
                if (container != null)
                {
                    container.setAttribute("style", "background: url(images/PatcherPlayButtonOnClick.png)no-repeat 0 0;");
                    playtext.style.color = "#4e4e4e";
                    Client.playCurrentApp();
                }
                else
                {
                    return;
                }
            }


            function showMouseDownValidateButton()
            {
                var container = document.getElementById("Validatebutton_active");
                if (container != null)
                {
                    container.setAttribute("style", "background: url(images/PatcherValidateButtonOnClick.png)no-repeat 0 0;");
                }
                else
                {
                    return;
                }
            }


            function clickValidateButton()
            {
                setPatcherStatus( false );
                Client.checkImage();
            }

            function RestoreButtons()
            {

                //enable play button
                var deactivePlayButtonContainer = document.getElementById("Playbutton_active");
                if (deactivePlayButtonContainer != null)
                {
                    deactivePlayButtonContainer.setAttribute("style", "display: none;");
                }
                else
                {
                    return;
                }
                var activePlayButtonContainer = document.getElementById("Playbutton_deactive");
                if (activePlayButtonContainer != null)
                {
                    activePlayButtonContainer.setAttribute("style", "display: visible;");
                }
                else
                {
                    return;
                }


                //enable validate button
                var deactiveValidateButtonContainer = document.getElementById("Validatebutton_active");
                if (deactiveValidateButtonContainer != null)
                {
                    deactiveValidateButtonContainer.setAttribute("style", "display: none;");
                }
                else
                {
                    return;
                }
                var activeValidateButtonContainer = document.getElementById("Validatebutton_deactive");
                if (activeValidateButtonContainer != null)
                {
                    activeValidateButtonContainer.setAttribute("style", "display: visible;");
                }
                else
                {
                    return;
                }

            }


            function clickCheckImageCalledButton()
            {
                var container = document.getElementById("Validatebutton_active");
                var playtext = document.getElementById("Validate_button_font_active");
                if (container != null)
                {
                    container.setAttribute("style", "background: url(images/PatcherValidateButtonActive.png)no-repeat 0 0;");
                    playtext.style.color = "#ffffff";
                    Client.checkImage();
                }
                else
                {
                    return;
                }
            }


            function onMouseDownCloseButton()
            {
                mousebuttondown = true;
                var container = document.getElementById("Closebutton");
                if (container != null)
                {
                    container.style.visibility = "hidden";
                    container.className = "closeButton clicked";
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }
            function onMouseDownMinButton()
            {
                mousebuttondown = true;
                var container = document.getElementById("Minbutton");
                if (container != null)
                {
                    container.style.visibility = "hidden";
                    container.className = "minButton clicked";
                    container.style.visibility = "visible";
                }
                else
                {
                    return;
                }
            }
            function mouseReset(){
                mousebuttondown = false;
            }
            function updateUpperleftProgressComment(text){
                var container = document.getElementById("Progress_comment_upper_left_container");
                container.firstChild.innerHTML = text;
            }
            function updateBottomleftProgressComment(text){
                var container = document.getElementById("Progress_comment_bottom_left_container");
                container.firstChild.firstChild.innerHTML = text;
                ellipsisTestLeftComment(container);
                updateToolTipTextLeft(text);
            }


            function updateBottomrightProgressComment(text){
                var container = document.getElementById("Progress_comment_bottom_right_container");
                container.firstChild.firstChild.innerHTML = text;
                ellipsisTestRightComment(container);
                updateToolTipTextRight();
            }
            function openNewBrowser(url)
            {
                Client.openBrowser(url);
            }

            function ellipsisTestLeftComment(container)
            {
                var parentContainerWidth = container.clientWidth;
                var spanContainer = container.firstChild;
                var spanContainerWidth = spanContainer.clientWidth;
                var ellipsisDiv = document.getElementById("Left_comment_ellipsis");
                if (spanContainerWidth > parentContainerWidth)
                {
                    ellipsisDiv.style.display = "inline";
                    container.style.width = 246

                }
                else
                {
                    ellipsisDiv.style.display = "none";
                    container.style.width = 255
                }


            }

            function ellipsisTestRightComment(container)
            {
                var parentContainerWidth = container.clientWidth;
                var spanContainer = container.firstChild;
                var spanContainerWidth = spanContainer.clientWidth;
                var ellipsisDiv = document.getElementById("Right_comment_ellipsis");
                if (spanContainerWidth > parentContainerWidth)
                {
                    ellipsisDiv.style.display = "inline";
                    container.style.width = 122;

                }
                else
                {
                    ellipsisDiv.style.display = "none";
                    container.style.width = 131;
                }


            }


            /**
             * if the patcher has completed it's business or not
             */
            function setPatcherStatus(completed)
            {

                mPatcherStatus = completed;

                // check if the player allowed to proceed to the game
                checkPlayStatus();


            } //end setPatcherStatus

            /**
             * Set the current state of the servers, and having the launcher take
             * action if appropriate
             * @param bool health if our servers are healthy and reachable
             * @param bool maintenance if the servers are down for maintenance/temporary reasons
             * @param bool throttle if the game is currently being throttled and not letting eople in
             * @param int countdown a unix timestamp to when the game will be available, or 0 for no countdown
             */
            function setServerStatus(health, maintenance, countdown)
            {
                mServerStatus = true;
                mServerHealth = health;
                mServerMaintenance = maintenance;
                mCountdown = countdown;


                // replace the light with our more up to date knowledge
                var container = document.getElementById("Server_condition");
                var innervar;
                if (mServerHealth) {
                    innervar = '<div style="color:#FFFFFF;font-size:11px;" align="right">'+localizedstringmap['SERVER_GOOD'];
                    innervar += '<img src="images/icon_light_green.png" style="position: relative;top: 3px; left: 2px;" /></div>';
                }
                else if (mServerMaintenance) {
                    innervar = '<div style="color:#FFFFFF;font-size:11px;" align="right">'+localizedstringmap['SERVER_UNAVAILABLE'];
                    innervar += '<img src="images/icon_light_yellow.png" style="position: relative;top: 3px; left: 2px;"  /></div>';
                    mError = true;
                } else {
                    innervar = '<div style="color:#FFFFFF;font-size:11px;" align="right">'+localizedstringmap['SERVER_UNAVAILABLE'];
                    innervar += '<img src="images/icon_light_red.png" style="position: relative;top: 3px; left: 2px;"  /></div>';
                    mError = true;
                }

                container.innerHTML = innervar;

                // check if the player is allowed to proceed to the game
                checkPlayStatus();


            } //end setServerStatus


            /**
             * once the server status and patcher status have been updated, we can
             * go on and let the player through if all lights are green
             */
            function checkPlayStatus()
            {
                // if the patcher isn't ready or the server isn't ready or there was an error or we can't talk to the server
                if (mPatcherStatus && mServerStatus && !mError && mServerHealth)
                {
                    // turn on the play button
                    updateProgressBar(1.0);
                    setPlayButtonActive();

                    if (hasClientCheckImage()) {
                        setValidateButtonActive();
                    }
                    else {
                        setValidateButtonDeactive();
                    }
                }
                else
                {
                    // turn off play button
                    updateProgressBar(0.0);
                    setPlayButtonActive();
                    setValidateButtonDeactive();

                    // if a countdown timer is enabled, start er up
                    if (mRefresh)
                    {
                        startCountdown();
                    }
                }
            } // end checkPlayStatus

            /**
             * Sets the content frame as a url
             */
            function setFrameAsUrl(url)
            {
                // make sure no errors are already in place
                if (!mError) {
                    el = document.getElementById('Patch_note_frame');
                    if (null != el)
                    {
                        altUrl = "/bootstrap/launcher/notes";
                        el.innerHTML =  '<iframe id="Patch_Content_Frame" src ="' + altUrl + '" width="473" height="280" frameBorder="0"></iframe>';
                    }
                }
            } //end setFrameAsUrl

            function setFrameAsEmpty()
            {

                // make sure no errors are already in place
                if (!mError) {

                    el = document.getElementById('Patch_note_frame');
                    if (null != el)
                    {
                        el.innerHTML =  '';
                    }

                }

            } //end setFrameAsUrl


            /**
             * Sets the content frame as an error
             */
            function setFrameAsError(key, refreshable) {

                // we don't want to replace an existing error unless it's more
                // serious
                if (!mError || (mRefresh && !refreshable)) {

                    stopCountdown();
                    mRefresh = refreshable;
                    mError = true;

                    var errortext = key;
                    var matchedhead = errortext.match(/(\*\*\*).*(\*\*\*)/gi);
                    var matchedheadstring = matchedhead[0].replace(/(\*\*\*)/gi,'');
                    if (matchedheadstring == null)
                        matchedheadstring = '';
                    var matchedbody = errortext.match(/>.*</gi);
                    var matchedbodystring = matchedbody[0].replace(/(>|<)/gi,'');
                    if (matchedbodystring == null)
                        matchedbodystring = '';
                    var bodylinkstring = matchedbodystring.match(/(http:\/\/).*?(?=(\s|$))/gi);
                    if (bodylinkstring!=null)
                        matchedbodystring = matchedbodystring.replace(bodylinkstring[0],'<span style="color:#B0C5FF;text-decoration:underline;" onclick="javascript:openNewBrowser(\''+bodylinkstring[0]+'\');">'+bodylinkstring[0]+'</span>');
                    var supportstring = localizedstringmap['SUPPORT_STRING'];
                    var linkstring = supportstring.match(/(http:\/\/).*?(?=(\s|$))/gi);
                    if (linkstring!=null)
                        supportstring = supportstring.replace(linkstring[0],'<span style="color:#B0C5FF;text-decoration:underline;" onclick="javascript:openNewBrowser(\''+linkstring[0]+'\');">'+linkstring[0]+'</span>');
                    var formatedmsg = ' '+matchedheadstring + '<span style="font-size:13px;font-weight:normal;color:white;"><br/><br/>'+matchedbodystring+'<br/><br/>'+supportstring+'</span>';

                    el = document.getElementById('Patch_note_frame');
                    if (null != el) {
                        el.innerHTML = '<img id="Warn_Img" src="images/launcherwarnimg.png"  style="position:relative;top:5px;left:0px;" width="20" height="20" frameBorder="0"/><span id="ERROR_TEXT" style="color:red;font-size:14px;font-weight:bold;">' + formatedmsg + '</span>';
                    }

                }

            } //end setFrameAsError


            /**
             * attemps a bypass of the launcher to let the important people through
             * note that a bypass won't work if the error is of the bad variety
             */
            function attemptBypass()
            {

                if (mError && mRefresh)
                {
                    // basically lie and say everything is OK
                    mError = false;
                    mServerHealth = true;
                    checkPlayStatus();
                }

            } // end attemptByPass


            /**
             * start a countdown timer to when the servers will open
             */
            function startCountdown()
            {

                var now = new Date();
                var diff = (mCountdown * 1000) - now.getTime();

                if (0 < diff) {
                    mCountdownId = setInterval("updateCountdown()", 500);
                }

            } //end startCountdown

            /**
             * stop our countdown
             */
            function stopCountdown()
            {

                if (-1 < mCountdownId)
                {
                    clearInterval(mCountdownId);
                    mCountdownId = -1;
                }

            }

            /**
             * update the coundown timer
             */
            function updateCountdown()
            {

                // how much time till go time?

                var ts = Math.round(new Date().getTime() / 1000);
                var diff = mCountdown - ts;
                diff = Math.max(0, diff);
                original = diff;

                // will display time in 10:30:23 format
                var formattedTime = "00:00:00";
                if (0 < diff) {

                    var hours = Math.floor(diff / (60 * 60));
                    diff = diff % (60 * 60);

                    var minutes = Math.floor(diff / 60);
                    diff = diff % 60;

                    seconds = diff;

                    hours = hours < 10 ? ("0" + hours.toString()) : hours.toString();
                    minutes = minutes < 10 ? ("0" + minutes.toString()) : minutes.toString();
                    seconds = seconds < 10 ? ("0" + seconds.toString()) : seconds.toString();

                    formattedTime = hours + ":" + minutes + ":" + seconds;
                }

                // update the timer text
                el = document.getElementById("Play_button_font_countdown");
                if (null != el)
                {
                    el.innerHTML = formattedTime;
                }

                // hit 0? stop and see where we are at
                if (0 == original) {
                    refreshStatus();
                }

            }

            function gameVersion() {
              var queryDict = {}
              location.search.substr(1).split("&").forEach(function(item) {queryDict[item.split("=")[0]] = item.split("=")[1]})
              return queryDict["version"];
            }
            function gameVersionParts() {
              var version = gameVersion();
              if (version === undefined) return true;

              var versionParts = version.split(".");
              if (versionParts.length !== 4) return true;

              var versionComp1 = parseInt(versionParts[0]);
              var versionComp2 = parseInt(versionParts[1]);
              var versionComp3 = parseInt(versionParts[2]);
              var versionComp4 = parseInt(versionParts[3]);
              return [versionComp1,versionComp2,versionComp3,versionComp4];
            }
            function isGameVersionAtLeast(versionArray) {
              var versionParts = gameVersionParts();
              if (versionParts[0] > versionArray[0]) return true;
              if (versionParts[1] > versionArray[1]) return true;
              if (versionParts[2] > versionArray[2]) return true;
              return versionParts[3] >= versionArray[3];
            }
            function hasClientRequestStatusRefresh() {
              return isGameVersionAtLeast([5,3,0,103]);
            }
            function hasClientCheckImage() {
              return isGameVersionAtLeast([5,3,0,127]);
            }

            /**
             * request a server side refresh
             */
            function refreshStatus() {
                mError = false;
                stopCountdown();
                if (hasClientRequestStatusRefresh()) {
                    Client.requestStatusRefresh();
                    return;
                }

                setServerStatus(true, false, 0);
            }

            /**
             * Our text needs to be localized!
             */
            function setLocalizedText(){
                localizedstringmap = localizedkeymap;

                // play button
                document.getElementById("Play_button_font_active").innerHTML = localizedstringmap['PLAY'];

                // validate button
                document.getElementById("Validate_button_font_active").innerHTML = localizedstringmap['VALIDATE_INSTALL'];

                // server status
                document.getElementById("Server_Header").innerHTML = localizedstringmap['SERVER_STATUS'];

                // server condition
                var container = document.getElementById("Server_condition");
                var innervar;
                innervar = '<div style="color:#FFFFFF;font-size:11px;" align="right">'+localizedstringmap['CONTACTING'];
                innervar += '<img src="images/icon_light_yellow.png" style="position: relative;top: 3px; left: 2px;" /></div>';
                container.innerHTML = innervar;

            }

            window.onload = function()
            {

                setLeftCommentActive();
                setRightCommentActive();
                // random picture on the right side
                Math.floor(Math.random() * 9);
                document.getElementById("Mood_Painting").style.backgroundImage = 'url(images/moodimage' + (Math.floor(Math.random() * 9)) + '.png)';

                // start the patcher progress part to 0
                updateProgressBar(0.0);

                // localized material
                setLocalizedText();

                if (!hasClientRequestStatusRefresh()) {
                    refreshStatus();
                    setFrameAsUrl(undefined);
                }

                // refresh the launcher every 5 minutes
                setInterval("refreshStatus()", 300000);

            }

        </script>
        <style type="text/css">

            * {
                font-family:"EA Pirulen Rg DS";
            }

            body{
                background: url(images/PatcherBackgroundImage.png) no-repeat 0 0;
                height: 600;
                width: 800px;
                margin: 0;
                -moz-user-select: none;
                -webkit-user-select: none;
            }

            #server_notes{
                -moz-user-select: none;
                -webkit-user-select: none;
            }

            #Server_status{
                position:relative;
                width: 400px;
                height: 55px;
                top: 10px;
                left: 18px;
                -moz-user-select: none;
                -webkit-user-select: none;
            }
            #Progress_bar{
                background: url(images/ProgressBarEmpty.png)no-repeat 0 0;
                width: 537px;
                height: 21px;
                margin-top: 12px;
                margin-left: 17px;
            }

            #Progress_bar_full{
                background: url(images/ProgressBarFull.png)no-repeat 0 0;
                width: 537px;
                height: 21px;
                margin-top: 12px;
                margin-left: 17px;
            }

            #Progress_bar_patching_end{
                background: url(images/PatcherProgressEnd.png)no-repeat 0 0;
                position: relative;
                width: 5px;
                height: 15px;
                left: -3px;
                top: 0px;
            }

            #Progress_bar_patching_middle{
                background: url(images/PatcherProgressMiddle.png);
                position: relative;
                width: 1px;
                height: 15px;
                left: -7px;
                top: 0px;
            }

            #Progress_bar_patching_head{
                background: url(images/PatcherProgressHead.png) no-repeat 0 0;
                position: relative;
                width: 5px;
                height: 21px;
                top: 3px;
                left:-11px;
            }

            .minButton.off{
                background: url(images/PatcherMinButtonOn.png)no-repeat 0 0;
                background: url(images/PatcherMinButtonOff.png)no-repeat 0 0;
                width: 36px;
                height: 27px;
                Position: absolute;
                left: 726px;
            }

            .minButton.clicked{
                background: url(images/PatcherMinButtonOnClick.png)no-repeat 0 0;
                width: 36px;
                height: 27px;
                Position: absolute;
                left: 726px;
            }

            .minButton.on{
                background: url(images/PatcherMinButtonOn.png)no-repeat 0 0;
                width: 36px;
                height: 27px;
                Position: absolute;
                left: 726px;
            }

            .closeButton.off{
                background: url(images/PatcherCloseButtonOn.png)no-repeat 0 0;
                background: url(images/PatcherCloseButtonOff.png)no-repeat 0 0;
                width: 35px;
                height: 27px;
                Position: absolute;
                left: 762px;
            }

            .closeButton.on{
                background: url(images/PatcherCloseButtonOn.png)no-repeat 0 0;
                width: 36px;
                height: 27px;
                Position: absolute;
                left: 762px;
            }

            .closeButton.clicked{
                background: url(images/PatcherCloseButtonOnClick.png)no-repeat 0 0;
                width: 36px;
                height: 27px;
                Position: absolute;
                left: 762px;
            }

            #Playbutton_deactive{
                background: url(images/PatcherPlayButtonDisable.png)no-repeat 0 0;
                position: relative;
                width: 224px;
                height: 37px;
                top: 26px;
                left: 6px;
            }

            #Playbutton_active{
                background: url(images/PatcherPlayButtonOn.png)no-repeat 0 0;
                background: url(images/PatcherPlayButtonActive.png)no-repeat 0 0;
                position: relative;
                width: 224px;
                height: 37px;
                top: 26px;
                left: 6px;
            }

            #Playbutton_on{
                background: url(images/PatcherPlayButtonOn.png)no-repeat 0 0;
                position: relative;
                width: 224px;
                height: 37px;
                top: 26px;
                left: 6px;
            }

            #Playbutton_label_container{
                width: 100px;
                height: 20px;
                position: relative;
                top: 9px;
            }

            #Play_button_font_active{
                color: #FFFFFF;
                font-size: 18px;
            }


            #Validatebutton_deactive{
                background: url(images/PatcherValidateButtonDisabled.png)no-repeat 0 0;
                position: relative;
                width: 132px;
                height: 20px;
                top: 1px;
                left:2px;
                float:right;
            }

            #Validatebutton_active{
                background: url(images/PatcherValidateButtonOn.png)no-repeat 0 0;
                background: url(images/PatcherValidateButtonActive.png)no-repeat 0 0;
                position: relative;
                width: 132px;
                height: 20px;
                top: 1px;
                left:2px;
                float:right;
            }

            #Validatebutton_on{
                background: url(images/PatcherValidateButtonOn.png)no-repeat 0 0;
                position: relative;
                width: 132px;
                height: 20px;
                top: 1px;
                left:2px;
            }

            #Validatebutton_label_container{
                width: 132px;
                height: 20px;
                position: relative;
                top: 9px;
            }

            #Validate_button_font_active{
                color:#FFFFFF;
                font-family: Arial;
                font-size:11px;
                text-align:center;
                margin: 0 auto;
                top:-6px;
                width:132px;

            }



            #DLC_Font{
                color:#FFFFFF;
                font-size:14px;
                visibility: hidden;
            }


            #Play_button_font_countdown{
                color:#FFFFFF;
                font-size: 18px;
            }


            #Patch_note_frame{
                position: relative;
                width: 434px;
                height: 287px;
                top: 16px;
                left: 5px;
            }

            .Progress_comment_font{
                color:#FFFFFF;
                font-size:11px;
                padding-right: 15px;
                white-space: nowrap;
                display:inline;
            }

            .remove_right_padding
            {
                padding-right:0px !important;
            }

            .text_exceeds_bounds{
                width:800px !important;
            }

            #Progress_comment_upper_left_container{
                position: relative;
                height: 12px;
                width: 100px;
                top: 29px;
                left: 18px;
            }

            #Progress_comment_bottom_left_container{
                position: relative;
                left: 18px;
                width:246px;
                float:left;
                top:4px;
                overflow:hidden;

            }

            #Progress_comment_bottom_left_tooltip
            {
                position: absolute;
                border: solid 1px black;
                background-color: #ffffe1;
                color:#000000;
                font-size:11px;
                z-index:20;
                bottom: 17px;
                left:20px;

                overflow:hidden;
             }

            #Progress_comment_bottom_right_tooltip
            {
                position: absolute;
                border: solid 1px black;
                background-color: #ffffe1;
                color:#000000;
                font-size:11px;
                z-index:20;
                bottom: 17px;

                overflow:hidden;
             }


            .exceed_bounds_test
            {
                white-space:nowrap;


            }

           .Progress_left_comment_font_ellipsis{
                color:#FFFFFF;
                font-size:11px;

            }

            .Progress_right_comment_font_ellipsis{
                color:#FFFFFF;
                font-size:11px;

            }



            #Left_comment_ellipsis
            {
                float:left;
                top:4px;
                height: 12px;
                position:relative;
                left:18px;
                width:9px;
            }

            #Right_comment_ellipsis
            {
                top:60px;
                height: 12px;
                right:368px;
                width:9px;
            }



            #Progress_comment_bottom_right_container{
                position: absolute;
                left: 278px;
                padding-right:15px;
                top:60px;
                overflow:hidden;
            }

            #ValidateInstallButton_active
            {
                background: url(images/validate_button.jpg)no-repeat 0 0;
            }

            #ValidateInstallButton_deactive
            {
                background: url(images/validate_button.jpg)no-repeat 60px 0px;
            }



            #Server_Header{
                color:#829095;
                font-size:16px;
            }


        </style>
    </head>
    <body id="Main_Body" onMouseup="mouseReset()">

        <table>
            <tr>
                <td><div id="Minbutton"   class="minButton off" onMouseOver="showMouseOverMinButton()" onMouseOut="showMouseOutMinButton()" onMouseUp="clickMinButton()" onMouseDown="onMouseDownMinButton()"></div></td>
                <td><div id="Closebutton" class="closeButton off" onMouseOver="showMouseOverCloseButton()" onMouseOut="showMouseOutCloseButton()" onMouseUp="clickCloseButton()" onMouseDown="onMouseDownCloseButton()"></div></td>
            </tr>
        </table>

        <!-- Random darkspore pic -->
        <div id="Mood_Painting" style="width:393px;height:497px;position:absolute;top:35px;left:15px;background-repeat:no-repeat;"></div>

        <!-- Server status -->
        <div id="server_notes">
            <div id="Server_status" style="position: absolute;top: 60px; left: 355px;">
                <div id="Server_Status_Header" style="position: relative;top: 7px; left: 4px;padding-bottom:10px;" align="right">
                    <span id="Server_Header"></span>
                </div>
                <span id="Server_condition">
                     <div style="color:#FFFFFF; font-size:11px;" align="right">
                     </div>
                </span>
            </div>
        </div>

        <!-- Display downloaded patch notes -->
        <div id="Patch_note_frame" style="position:absolute; top:147px; left:292px; width:430px">

        </div>

        <!-- Patching progress and play button -->
        <div id="Play_container" style="display:block; position:absolute; top:512px; left:-3px;">
            <div id="Progress_comment_upper_left_container"><font class="Progress_comment_font"></font></div>
            <table>
                <tr>
                    <td><div id="Progress_bar">
                            <table>
                                <tr>
                                    <td><div id="Progress_bar_patching_end"></div>
                                    </td>
                                    <td><div id="Progress_bar_patching_middle"></div>
                                    </td>
                                    <td><div id="Progress_bar_patching_head"></div>
                                    </td>
                                </tr>
                            </table></div>
                    </td>

                    <td>
                        <div id="Playbutton_deactive" align="center">
                            <div id="Playbutton_label_container" style="position: relative;top: 6px;">
                                <span id="Play_button_font_countdown" style="position: relative;"></span>
                            </div>
                        </div>

                         <div id="Playbutton_active" align="center" style="display:none;">
                            <div id="Playbutton_label_container" style="position: relative;top: 6px;">
                                <span id="Play_button_font_active" style="position: relative;"></span>
                            </div>
                        </div>

                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="Progress_comment_bottom_left_tooltip" style="display:none;"></div>
                        <div id="Progress_comment_bottom_left_container"><span style="display:inline-block; width:auto;" class="exceed_bounds_test"><font class="Progress_comment_font remove_right_padding"></font></span></div>
                        <div id="Left_comment_ellipsis" style="display:none;"><div class="Progress_left_comment_font_ellipsis">...</div></div>

                        <div id="Progress_comment_bottom_right_tooltip" style="display:none;"></div>
                        <div id="Progress_comment_bottom_right_container" align="right"><span style="display:inline-block;padding-right:15px;" class="exceed_bounds_test"><font class="Progress_comment_font"></font></span></div>
                        <div id="Right_comment_ellipsis" style="display:none;"><div class="Progress_right_comment_font_ellipsis">...</div></div>


                        <div id="Validatebutton_deactive" >
                            <div id="Validatebutton_label_container" style="position: relative;">
                                <div id="Validate_button_font_deactive" style="position: relative;"></div>
                            </div>
                        </div>


                        <div id="Validatebutton_active" style="display:none;">
                            <div id="Validatebutton_label_container" style="position: relative;">
                                <div id="Validate_button_font_active" style="position: relative;"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                    </td>



                </tr>
            </table>
        </div>
    </body>
</html>
